/*
 Knockout.Punches
 Enhanced binding syntaxes for Knockout 3+
 (c) Michael Best
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 0.2.1
*/
(function(c){"function"===typeof define&&define.amd?define(["knockout"],c):c(ko)})(function(c){function f(a,b){p(v(a),"preprocess",b)}function v(a){return"object"===typeof a?a:c.getBindingHandler(a)||(c.bindingHandlers[a]={})}function p(a,b,d){if(a[b]){var e=a[b];a[b]=function(a,b,c){if(a=e.call(this,a,b,c))return d.call(this,a,b,c)}}else a[b]=d}function x(a){var b=c.bindingProvider.instance;if(b.preprocessNode){var d=b.preprocessNode;b.preprocessNode=function(b){var c=d.call(this,b);c||(c=a.call(this,
b));return c}}else b.preprocessNode=a}function y(a,b){var d=c.getBindingHandler;c.getBindingHandler=function(e){var c;return d(e)||(c=e.match(a))&&b(c,e)}}function r(a){if(-1===a.indexOf("|"))return a;var b=a.match(/"([^"\\]|\\.)*"|'([^'\\]|\\.)*'|\|\||[|:]|[^\s|:"'][^|:"']*[^\s|:"']|[^\s|:"']/g);if(b&&1<b.length){b.push("|");a=b[0];for(var d,e,c=!1,q=!1,w=1;e=b[w];++w)"|"===e?(c&&(":"===d&&(a+="undefined"),a+=")"),c=q=!0):(q?a="ko.filters['"+e+"']("+a:c&&":"===e?(":"===d&&(a+="undefined"),a+=","):
a+=e,q=!1),d=e}return a}function z(a){f(a,r)}function s(a,b,d){function e(d){g[d]&&(g[d]=function(e,g){var f=Array.prototype.slice.call(arguments,0);f[1]=function(){var b={};b[a]=g();return b};return c.bindingHandlers[b][d].apply(this,f)})}var g=c.utils.extend({},this);e("init");e("update");g.preprocess&&(g.preprocess=null);c.virtualElements.allowedBindings[b]&&(c.virtualElements.allowedBindings[d]=!0);return g}function t(a,b){var d=c.getBindingHandler(a);if(d){var e=d.getNamespacedHandler||s;d.getNamespacedHandler=
function(){return f(e.apply(this,arguments),b)}}}function A(a,b,d){if("{"!==a.charAt(0))return a;a=c.expressionRewriting.parseObjectLiteral(a);c.utils.arrayForEach(a,function(a){d(b+B+a.key,a.value)})}function l(a){f(a,A)}function k(a){return/^([$_a-z][$\w]*|.+(\.\s*[$_a-z][$\w]*|\[.+\]))$/i.test(a)?"function(_x,_y,_z){return("+a+")(_x,_y,_z);}":a}function m(a){f(a,k)}function n(a,b,d){a=v(a);a._propertyPreprocessors||(p(a,"preprocess",F),a._propertyPreprocessors={});p(a._propertyPreprocessors,b,
d)}function F(a,b,d){if("{"!==a.charAt(0))return a;a=c.expressionRewriting.parseObjectLiteral(a);var e=[],g=this._propertyPreprocessors||{};c.utils.arrayForEach(a,function(a){var b=a.key;a=a.value;g[b]&&(a=g[b](a,b,d));a&&e.push("'"+b+"':"+a)});return"{"+e.join(",")+"}"}function u(a){return function(b){return"function("+a+"){return("+b+");}"}}function C(a){if(3===a.nodeType&&a.nodeValue&&-1!==a.nodeValue.indexOf("{{")){var b=[],d=function(a){a&&b.push(document.createTextNode(a))},c=function(a){b.push.apply(b,
G.wrapExpresssion(a))},g=function(a){var b=a.match(/^([\s\S]*?)\{\{([\s\S]*)}}([\s\S]*)$/);if(b){d(b[1]);a=b[2];var f=a.match(/^([\s\S]*?)}}([\s\S]*)\{\{([\s\S]*)$/);f?(c(f[1]),g(f[2]),c(f[3])):c(a);d(b[3])}else d(a)};g(a.nodeValue);if(1<b.length){if(a.parentNode){for(var f=0;f<b.length;f++)a.parentNode.insertBefore(b[f],a);a.parentNode.removeChild(a)}return b}}}function D(){x(C)}var h=c.punches={utils:{setBindingPreprocessor:f,setNodePreprocessor:x,setBindingHandlerCreator:y}};h.enableAll=function(){D();
l("attr");l("css");l("event");l("style");z("text");t("attr",r);m("click");m("submit");m("optionsAfterRender");t("event",k);n("template","beforeRemove",k);n("template","afterAdd",k);n("template","afterRender",k)};c.filters={uppercase:function(a){return String.prototype.toUpperCase.call(a)},lowercase:function(a){return String.prototype.toLowerCase.call(a)},"default":function(a,b){return""===a||null==a?b:a},replace:function(a,b,d){return String.prototype.replace.call(a,b,d)},fit:function(a,b,d,c){if(b&&
(""+a).length>b)switch(d=""+(d||"..."),b-=d.length,a=""+a,c){case "left":return d+a.slice(-b);case "middle":return c=Math.ceil(b/2),a.substr(0,c)+d+a.slice(c-b);default:return a.substr(0,b)+d}else return a},json:function(a,b,d){return c.toJSON(a,d,b)},number:function(a){return(+a).toLocaleString()}};h.textFilter={preprocessor:r,enableForBinding:z};var B=".";y(/([^\.]+)\.(.+)/,function(a,b){var d=a[1],e=c.bindingHandlers[d];if(e)return d=(e.getNamespacedHandler||s).call(e,a[2],d,b),c.bindingHandlers[b]=
d});h.namespacedBinding={defaultGetHandler:s,setDefaultBindingPreprocessor:t,preprocessor:A,enableForBinding:l};h.wrappedCallback={preprocessor:k,enableForBinding:m};h.preprocessBindingProperty={setPreprocessor:n};var E=u("$data,$event");h.expressionCallback={makePreprocessor:u,eventPreprocessor:E,enableForBinding:function(a,b){b=Array.prototype.slice.call(arguments,1).join();f(a,u(b))}};c.bindingHandlers.on={getNamespacedHandler:function(a){a=c.getBindingHandler("event"+B+a);f(a,E);return a}};var G=
h.interpolationMarkup={preprocessor:C,enable:D,wrapExpresssion:function(a){return[document.createComment("ko text:"+a),document.createComment("/ko")]}}});